---
title: "Node.jsã§å¯¾è©±å‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚‹"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Node", "cli", "readline", "inquirer"]
published: true
publication_name: "cureapp"
---

ã“ã‚Œã¯[CureApp Advent Calendar 2023](https://qiita.com/advent-calendar/2023/cureapp) 4æ—¥ç›®ã®è¨˜äº‹ã¨ãªã‚Šã¾ã™ã€‚

# ã¯ã˜ã‚ã«

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚„ã‚·ã‚§ãƒ«ãªã©ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã€å„ç¨®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  
ãã®ä¸­ã§ã‚‚ã€å®Ÿè¡Œå¾Œã«ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰å…¥åŠ›ã‚’æ±‚ã‚ã‚‰ã‚ŒãŸã‚Šã€é¸æŠã‚’ä¿ƒã•ã‚ŒãŸã‚Šã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚  
å‰Šé™¤ã‚„ãƒ‡ãƒ—ãƒ­ã‚¤ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸéš›ã«ã€`y/n`ã®å…¥åŠ›ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ãªã‚‚ã®ãŒã€æœ€ã‚‚æœ‰åãªä¾‹ã ã¨æ€ã„ã¾ã™ã€‚

```shell
# ï¼ˆä¾‹ deleteã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã¯å®Ÿéš›ã«ã¯å­˜åœ¨ã—ã¾ã›ã‚“
delete hoge
> æœ¬å½“ã«hogeã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ(y/n)
y
> hogeã‚’å‰Šé™¤ã—ã¾ã—ãŸ
```

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã ã¨ã€`create-next-app`ã‚„`create-vue`ãªã©ãŒæœ‰åã§ã™ã­ã€‚  
å®Ÿè¡Œã™ã‚‹ã¨è¨€èªã‚„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã“ã‚Œã‚’ä½¿ã„ã¾ã™ã‹ã€ã¨ã„ã†ã®ã‚’ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«ã‚„ã‚Šå–ã‚Šã‚’ã—ã¾ã™ã€‚

```shell
npx create-next-app@latest

What is your project named?  my-app
Would you like to use TypeScript?  No / Yes
Would you like to use ESLint?  No / Yes
Would you like to use Tailwind CSS?  No / Yes
Would you like to use `src/` directory?  No / Yes
Would you like to use App Router? (recommended)  No / Yes
Would you like to customize the default import alias (@/*)?  No / Yes
```

ã¾ãŸã€Webã§ã„ã†ã¨ã“ã‚ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚„ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ã‚ˆã†ãªè¡¨ç¾ã‚’ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚  
yarnã«ã¯`upgrade-interactive`ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ãŒæä¾›ã•ã‚Œã¦ãŠã‚Šã€ãƒã‚§ãƒƒã‚¯ã‚’ã¤ã‘ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã ã‘ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![upgrade-interactiveã®å®Ÿè¡Œçµæœ](/images/interactive-cli/yarn-interactive.png)

ã“ã‚Œã‚’Node.jsã§å®Ÿè£…ã—ã¦ã¿ã‚ˆã†ã£ã¦ã„ã†å†…å®¹ã§ã™ã€‚

## readline

Node.jsã«ã¯readlineã¨ã„ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæä¾›ã•ã‚Œã¦ãŠã‚Šã€ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªã‚„ã‚Šå–ã‚ŠãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  
questionã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Šã€ã“ã‚Œã«å¤ãè‰¯ãã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢å¼ã§å‡¦ç†ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚  
answerã®ä¸­ã«ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å…¥åŠ›ã•ã‚ŒãŸå†…å®¹ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚

```ts
// question.ts
import { stdin as input, stdout as output } from "node:process";
import * as readline from "node:readline";

const rl = readline.createInterface({ input, output });

rl.question("å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/n): ", (answer) => {
  if (answer.toLowerCase() === "y") {
    console.log("å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™");
    rl.close();
  } else {
    console.log("å‡¦ç†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ");
    rl.close();
  }
});
```

å®Ÿè¡Œã™ã‚‹ã¨ã€ã“ã®ã‚ˆã†ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚  
å®Ÿè¡Œã™ã‚‹ã¨ã€ã€Œå‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/n): ã€ã®è¡¨ç¤ºãŒã•ã‚ŒãŸæ‰€ã§ã€å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã¾ã™ã€‚  
å…¥åŠ›å¾Œã€ã¾ãŸå‡¦ç†ãŒå†é–‹ã•ã‚Œã‚‹ã‚ˆã†ãªæŒ™å‹•ã«ãªã‚Šã¾ã™ã€‚

```shell
npx ts-node question.js
> å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/n): y
> å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™
```

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ãƒ—ãƒ­ãƒŸã‚¹ãªé–¢æ•°ã§ã¯ãªã„ãŸã‚ã€async/awaitã‚’ä½¿ã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

ä½¿ãˆãªã„ã¨ã„ã†ã®ã¯èªå¼ŠãŒã‚ã‚Šã¾ã™ãŒã€ãƒ—ãƒ­ãƒŸã‚¹ãªé–¢æ•°ã®ä¸­ã§ä¸Šè¨˜ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾æ›¸ãã¨ã€å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã‚‹ã“ã¨ãªãä¸€æ°—ã«å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚  
ä¾‹ãˆã°async/awaitã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‚ˆã†ãªå®Ÿè£…ã‚’ã™ã‚‹éš›ã«ã¯ã€ã“ã®readlineã‚’async/awaitã§ã‚‚æ‰±ãˆã‚‹ã‚ˆã†ã«ãƒ—ãƒ­ãƒŸã‚¹ãªé–¢æ•°ã«ã—ã¦ãŠã‹ãªã„ã¨ã„ã‘ã¾ã›ã‚“ã€‚

Node.js v17ã‹ã‚‰promissãªreadlineãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€å¿…è¦ã§ã‚ã‚Œã°ã“ã¡ã‚‰ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€‚

```ts
import { stdin as input, stdout as output } from "node:process";
import * as readline from "node:readline/promises";

const rl = readline.createInterface({ input, output });

async function main() {
  const result = await rl.question("å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/n): ");
  if (result === "y") {
    console.log("å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚");
  } else {
    console.log("å‡¦ç†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚");
  }
}

main();
```

:::details Node.js v16ã‚ˆã‚Šå‰ã§ã®ã‚„ã‚Šæ–¹
ãˆã€17ã‚ˆã‚Šã‚‚å‰ã‚‚Node.jsã—ã‹ä½¿ãˆãªã„ã ã£ã¦ãƒ»ãƒ»ãƒ»ï¼Ÿ  
ã—ã‚‡ã†ãŒãªã„ãªãã®ã³å¤ªãã‚“ã¯

```ts
import { stdin as input, stdout as output, exit } from "node:process";
import * as readline from "node:readline";

async function readlinePromises(
  ask: string = "å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/n)"
): Promise<boolean> {
  const rl = readline.createInterface({ input, output });

  return new Promise<boolean>((resolve) => {
    rl.question(`${ask}`, (answer) => {
      if (answer.toLowerCase() === "y") {
        console.log("å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™");
        resolve(true);
      } else {
        console.log("å‡¦ç†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ");
        resolve(false);
      }
    });
  }).finally(() => {
    rl.close();
  });
}

async function main() {
  const result = await readlinePromises();
  if (!result) exit(1);
  exit(0);
}

main();
```

:::

## readlineã§ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹

y/n ã®ã‚ˆã†ãªç°¡å˜ãªå¯¾è©±ã§ã‚ã‚Œã°æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸã¨æ€ã„ã¾ã™ãŒã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯ã©ã†ã§ã—ã‚‡ã†ã‹ã€‚  
ã“ã¡ã‚‰ã‚‚åŒæ§˜ã«readlineã‚’ä½¿ã£ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚  
ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ã£ã¦ã€åŒã˜è³ªå•ã‚’ç¹°ã‚Šæ›¿ãˆã—ã¦ç­”ãˆã¦ã‚‚ã‚‰ã†ã“ã¨ã§ã€è¤‡æ•°é¸æŠå¯èƒ½ãªå¯¾è©±ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
import { stdin as input, stdout as output, exit } from "node:process";
import * as readline from "node:readline/promises";

const question = "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ";
const options = ["TypeScript", "ESLint", "Tailwind CSS"];

async function askCheckbox(
  question: string,
  options: string[]
): Promise<string[]> {
  const rl = readline.createInterface({ input, output });

  const responses: string[] = [];

  try {
    while (true) {
      const optionString = options
        .map((option, index) => `${index + 1}. ${option}`)
        .join("\n");
      const answer = await rl.question(
        `${question}\n${optionString}\n(Enterã‚­ãƒ¼ã§çµ‚äº†): `
      );

      // EnterãŒæŠ¼ã•ã‚ŒãŸã‚‰çµ‚äº†
      if (answer.trim() === "") break;

      const index = parseInt(answer, 10) - 1;
      if (index >= 0 && index < options.length) {
        // æœ‰åŠ¹ãªé¸æŠãŒã•ã‚ŒãŸã‚‰è¿½åŠ 
        responses.push(options[index]);
      } else {
        console.log("ç„¡åŠ¹ãªé¸æŠã§ã™ã€‚ã‚‚ã†ä¸€åº¦é¸æŠã—ã¦ãã ã•ã„ã€‚");
      }
    }
  } finally {
    await rl.close();
  }

  return responses;
}

async function main() {
  const selectedOptions = await askCheckbox(question, options);

  console.log("é¸æŠã•ã‚ŒãŸæ©Ÿèƒ½:", selectedOptions);
}

main();
```

å®Ÿè¡Œã™ã‚‹ã¨ã€ã“ã®ã‚ˆã†ãªå½¢ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è¡¨ç¤ºã•ã‚Œã¦ã„ãã¾ã™ã€‚

```shell
npx ts-node question.js
> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ
> 1. TypeScript
> 2. ESLint
> 3. Tailwind CSS
> (Enterã‚­ãƒ¼ã§çµ‚äº†): 1
> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ
> 1. TypeScript
> 2. ESLint
> 3. Tailwind CSS
> (Enterã‚­ãƒ¼ã§çµ‚äº†): 3
> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ
> 1. TypeScript
> 2. ESLint
> 3. Tailwind CSS
> (Enterã‚­ãƒ¼ã§çµ‚äº†):
> é¸æŠã•ã‚ŒãŸæ©Ÿèƒ½: [ 'TypeScript', 'Tailwind CSS' ]

```

ã¨ã¦ã‚‚åŸå§‹çš„ãªã‚„ã‚Šæ–¹ã§ã™ãŒã€ã“ã‚Œã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã§ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## inquirer

ã“ã“ã§ç´¹ä»‹ã—ãŸå†…å®¹ã¯[inquirer](https://www.npmjs.com/package/inquirer)ã¨ã„ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã§ã‚‚ã€ç°¡å˜ã«å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  
ç°¡å˜ã ã—è¦‹ãŸç›®ã‚‚ãƒªãƒƒãƒã«ãªã‚Šã¾ã™ã€‚  
ã¡ãªã¿ã«ã€inquirerã‚‚å†…éƒ¨ã§ã¯readlineãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦å®Ÿè£…ãŒã•ã‚Œã¦ãŠã‚Šã¾ã™ã€‚

å…ˆã»ã©ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯inquirerã‚’ä½¿ã†ã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚  
ç´ ã®readlienã«æ¯”ã¹ã‚‹ã¨ã€ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã«æ›¸ã‘ã¾ã™ã€‚

```ts
import inquirer from "inquirer";

async function main() {
  const answers = await inquirer.prompt([
    {
      type: "checkbox",
      name: "features",
      message: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ",
      choices: [
        { name: "TypeScript", value: "typescript" },
        { name: "ESLint", value: "eslint" },
        { name: "Tailwind CSS", value: "tailwindcss" },
      ],
    },
  ]);

  console.log("é¸æŠã•ã‚ŒãŸæ©Ÿèƒ½:", answers.features);
}

main();
```
